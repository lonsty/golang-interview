# 08-ç»“æ„ä½“

[â† è¿”å›æœ¬ç« ç›®å½•](./README.md) | [â† è¿”å›æ€»ç›®å½•](../README.md)

---

## ğŸ“‹ ç›®å½•

- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [ç»“æ„ä½“å®šä¹‰](#ç»“æ„ä½“å®šä¹‰)
- [ç»“æ„ä½“åˆå§‹åŒ–](#ç»“æ„ä½“åˆå§‹åŒ–)
- [ç»“æ„ä½“æ–¹æ³•](#ç»“æ„ä½“æ–¹æ³•)
- [ç»“æ„ä½“åµŒå…¥](#ç»“æ„ä½“åµŒå…¥)
- [ç»“æ„ä½“æ ‡ç­¾](#ç»“æ„ä½“æ ‡ç­¾)
- [ç»“æ„ä½“å†…å­˜å¸ƒå±€](#ç»“æ„ä½“å†…å­˜å¸ƒå±€)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [é¢è¯•é¢˜](#é¢è¯•é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)

---

## æ ¸å¿ƒæ¦‚å¿µ

ç»“æ„ä½“ï¼ˆstructï¼‰æ˜¯ Go è¯­è¨€ä¸­ç”¨æˆ·è‡ªå®šä¹‰çš„å¤åˆæ•°æ®ç±»å‹ã€‚

```
ç‰¹ç‚¹ï¼š
1. å€¼ç±»å‹
2. å¯ä»¥å®šä¹‰æ–¹æ³•
3. æ”¯æŒåµŒå…¥ï¼ˆç»„åˆï¼‰
4. æ”¯æŒæ ‡ç­¾ï¼ˆtagï¼‰
5. é›¶å€¼å¯ç”¨
```

### ç»“æ„ä½“ vs ç±»

```
Go æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œä½†ç»“æ„ä½“ + æ–¹æ³•å¯ä»¥å®ç°é¢å‘å¯¹è±¡ï¼š
- å°è£…ï¼šé€šè¿‡é¦–å­—æ¯å¤§å°å†™æ§åˆ¶è®¿é—®æƒé™
- ç»§æ‰¿ï¼šé€šè¿‡åµŒå…¥å®ç°ç»„åˆ
- å¤šæ€ï¼šé€šè¿‡æ¥å£å®ç°
```

---

## ç»“æ„ä½“å®šä¹‰

### 1. åŸºæœ¬å®šä¹‰

```go
package main

import "fmt"

// å®šä¹‰ç»“æ„ä½“
type Person struct {
    Name string
    Age  int
}

// ç©ºç»“æ„ä½“
type Empty struct{}

// åŒ¿åç»“æ„ä½“
func main() {
    // ä½¿ç”¨å‘½åç»“æ„ä½“
    var p1 Person
    fmt.Println(p1)  // { 0}
    
    // ä½¿ç”¨åŒ¿åç»“æ„ä½“
    p2 := struct {
        Name string
        Age  int
    }{
        Name: "Alice",
        Age:  25,
    }
    fmt.Println(p2)  // {Alice 25}
}
```

### 2. å­—æ®µç±»å‹

```go
package main

import "fmt"

type Student struct {
    // åŸºæœ¬ç±»å‹
    Name string
    Age  int
    
    // æŒ‡é’ˆç±»å‹
    Father *Person
    
    // åˆ‡ç‰‡ç±»å‹
    Scores []int
    
    // Map ç±»å‹
    Grades map[string]int
    
    // ç»“æ„ä½“ç±»å‹
    Address Address
    
    // åŒ¿åå­—æ®µï¼ˆç±»å‹å³åç§°ï¼‰
    string
    int
}

type Person struct {
    Name string
}

type Address struct {
    City   string
    Street string
}

func main() {
    s := Student{
        Name:   "Alice",
        Age:    20,
        Father: &Person{Name: "Bob"},
        Scores: []int{90, 85, 95},
        Grades: map[string]int{"Math": 90},
        Address: Address{
            City:   "Beijing",
            Street: "Main St",
        },
        string: "anonymous string",
        int:    100,
    }
    
    fmt.Printf("%+v\n", s)
}
```

### 3. å­—æ®µå¯è§æ€§

```go
package main

// å¯¼å‡ºçš„ç»“æ„ä½“ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
type Person struct {
    // å¯¼å‡ºçš„å­—æ®µï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰
    Name string
    Age  int
    
    // æœªå¯¼å‡ºçš„å­—æ®µï¼ˆé¦–å­—æ¯å°å†™ï¼‰
    salary float64
}

// æœªå¯¼å‡ºçš„ç»“æ„ä½“ï¼ˆé¦–å­—æ¯å°å†™ï¼‰
type employee struct {
    name string
    age  int
}

func main() {
    p := Person{
        Name:   "Alice",
        Age:    25,
        salary: 10000,  // åŒä¸€åŒ…å†…å¯ä»¥è®¿é—®
    }
    
    // å…¶ä»–åŒ…æ— æ³•è®¿é—® salary å­—æ®µ
    fmt.Println(p.Name, p.Age)
}
```

---

## ç»“æ„ä½“åˆå§‹åŒ–

### 1. é›¶å€¼åˆå§‹åŒ–

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
}

func main() {
    // é›¶å€¼åˆå§‹åŒ–
    var p1 Person
    fmt.Printf("%+v\n", p1)  // {Name: Age:0}
    
    // é›¶å€¼å¯ç”¨
    p1.Name = "Alice"
    p1.Age = 25
    fmt.Printf("%+v\n", p1)  // {Name:Alice Age:25}
}
```

### 2. å­—é¢é‡åˆå§‹åŒ–

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
    City string
}

func main() {
    // æ–¹å¼ 1: æŒ‰å­—æ®µé¡ºåºï¼ˆä¸æ¨èï¼‰
    p1 := Person{"Alice", 25, "Beijing"}
    fmt.Printf("%+v\n", p1)
    
    // æ–¹å¼ 2: æŒ‡å®šå­—æ®µåï¼ˆæ¨èï¼‰
    p2 := Person{
        Name: "Bob",
        Age:  30,
        City: "Shanghai",
    }
    fmt.Printf("%+v\n", p2)
    
    // æ–¹å¼ 3: éƒ¨åˆ†å­—æ®µåˆå§‹åŒ–
    p3 := Person{
        Name: "Charlie",
        // Age å’Œ City ä½¿ç”¨é›¶å€¼
    }
    fmt.Printf("%+v\n", p3)  // {Name:Charlie Age:0 City:}
}
```

### 3. new å‡½æ•°

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
}

func main() {
    // new è¿”å›æŒ‡é’ˆ
    p := new(Person)
    fmt.Printf("Type: %T, Value: %+v\n", p, p)  // Type: *Person, Value: &{Name: Age:0}
    
    p.Name = "Alice"
    p.Age = 25
    fmt.Printf("%+v\n", p)  // &{Name:Alice Age:25}
}
```

### 4. æ„é€ å‡½æ•°

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
}

// æ„é€ å‡½æ•°ï¼ˆè¿”å›å€¼ï¼‰
func NewPerson(name string, age int) Person {
    return Person{
        Name: name,
        Age:  age,
    }
}

// æ„é€ å‡½æ•°ï¼ˆè¿”å›æŒ‡é’ˆï¼‰
func NewPersonPointer(name string, age int) *Person {
    return &Person{
        Name: name,
        Age:  age,
    }
}

// æ„é€ å‡½æ•°ï¼ˆå¸¦éªŒè¯ï¼‰
func NewPersonWithValidation(name string, age int) (*Person, error) {
    if age < 0 || age > 150 {
        return nil, fmt.Errorf("invalid age: %d", age)
    }
    return &Person{
        Name: name,
        Age:  age,
    }, nil
}

func main() {
    p1 := NewPerson("Alice", 25)
    fmt.Printf("%+v\n", p1)
    
    p2 := NewPersonPointer("Bob", 30)
    fmt.Printf("%+v\n", p2)
    
    p3, err := NewPersonWithValidation("Charlie", 200)
    if err != nil {
        fmt.Println("Error:", err)
    } else {
        fmt.Printf("%+v\n", p3)
    }
}
```

---

## ç»“æ„ä½“æ–¹æ³•

### 1. å€¼æ¥æ”¶è€…

```go
package main

import "fmt"

type Rectangle struct {
    Width, Height float64
}

// å€¼æ¥æ”¶è€…ï¼ˆä¸èƒ½ä¿®æ”¹åŸå¯¹è±¡ï¼‰
func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

// å€¼æ¥æ”¶è€…ï¼ˆä¿®æ”¹ä¸ä¼šå½±å“åŸå¯¹è±¡ï¼‰
func (r Rectangle) Scale(factor float64) {
    r.Width *= factor
    r.Height *= factor
}

func main() {
    rect := Rectangle{Width: 10, Height: 5}
    
    fmt.Println("Area:", rect.Area())  // 50
    
    rect.Scale(2)
    fmt.Println("After Scale:", rect)  // {10 5} (æœªæ”¹å˜)
}
```

### 2. æŒ‡é’ˆæ¥æ”¶è€…

```go
package main

import "fmt"

type Rectangle struct {
    Width, Height float64
}

// æŒ‡é’ˆæ¥æ”¶è€…ï¼ˆå¯ä»¥ä¿®æ”¹åŸå¯¹è±¡ï¼‰
func (r *Rectangle) Scale(factor float64) {
    r.Width *= factor
    r.Height *= factor
}

// æŒ‡é’ˆæ¥æ”¶è€…ï¼ˆé¿å…å¤åˆ¶å¤§å¯¹è±¡ï¼‰
func (r *Rectangle) Area() float64 {
    return r.Width * r.Height
}

func main() {
    rect := Rectangle{Width: 10, Height: 5}
    
    rect.Scale(2)
    fmt.Println("After Scale:", rect)  // {20 10} (å·²æ”¹å˜)
    
    fmt.Println("Area:", rect.Area())  // 200
}
```

### 3. å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…

```go
package main

import "fmt"

type Counter struct {
    count int
}

// å€¼æ¥æ”¶è€…
func (c Counter) IncrementValue() {
    c.count++
}

// æŒ‡é’ˆæ¥æ”¶è€…
func (c *Counter) IncrementPointer() {
    c.count++
}

func main() {
    c := Counter{count: 0}
    
    c.IncrementValue()
    fmt.Println("After IncrementValue:", c.count)  // 0 (æœªæ”¹å˜)
    
    c.IncrementPointer()
    fmt.Println("After IncrementPointer:", c.count)  // 1 (å·²æ”¹å˜)
}
```

**é€‰æ‹©åŸåˆ™ï¼š**

| åœºæ™¯ | æ¨è |
|------|------|
| éœ€è¦ä¿®æ”¹æ¥æ”¶è€… | æŒ‡é’ˆæ¥æ”¶è€… |
| æ¥æ”¶è€…æ˜¯å¤§å¯¹è±¡ | æŒ‡é’ˆæ¥æ”¶è€… |
| æ¥æ”¶è€…åŒ…å«ä¸å¯å¤åˆ¶å­—æ®µï¼ˆå¦‚ sync.Mutexï¼‰ | æŒ‡é’ˆæ¥æ”¶è€… |
| æ¥æ”¶è€…æ˜¯å°å¯¹è±¡ä¸”ä¸éœ€ä¿®æ”¹ | å€¼æ¥æ”¶è€… |
| æ¥æ”¶è€…æ˜¯ mapã€sliceã€channel | å€¼æ¥æ”¶è€… |

---

## ç»“æ„ä½“åµŒå…¥

### 1. åŒ¿ååµŒå…¥

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
}

func (p Person) SayHello() {
    fmt.Printf("Hello, I'm %s\n", p.Name)
}

type Student struct {
    Person  // åŒ¿ååµŒå…¥
    School string
}

func main() {
    s := Student{
        Person: Person{
            Name: "Alice",
            Age:  20,
        },
        School: "MIT",
    }
    
    // å¯ä»¥ç›´æ¥è®¿é—®åµŒå…¥å­—æ®µ
    fmt.Println(s.Name)    // Alice
    fmt.Println(s.Age)     // 20
    fmt.Println(s.School)  // MIT
    
    // å¯ä»¥è°ƒç”¨åµŒå…¥ç±»å‹çš„æ–¹æ³•
    s.SayHello()  // Hello, I'm Alice
}
```

### 2. å‘½ååµŒå…¥

```go
package main

import "fmt"

type Person struct {
    Name string
    Age  int
}

type Student struct {
    person Person  // å‘½ååµŒå…¥
    School string
}

func main() {
    s := Student{
        person: Person{
            Name: "Alice",
            Age:  20,
        },
        School: "MIT",
    }
    
    // å¿…é¡»é€šè¿‡å­—æ®µåè®¿é—®
    fmt.Println(s.person.Name)  // Alice
    fmt.Println(s.person.Age)   // 20
    fmt.Println(s.School)       // MIT
}
```

### 3. å¤šé‡åµŒå…¥

```go
package main

import "fmt"

type Person struct {
    Name string
}

type Employee struct {
    Company string
}

type Manager struct {
    Person    // åµŒå…¥ Person
    Employee  // åµŒå…¥ Employee
    Level int
}

func main() {
    m := Manager{
        Person:   Person{Name: "Alice"},
        Employee: Employee{Company: "Google"},
        Level:    5,
    }
    
    fmt.Println(m.Name)     // Alice
    fmt.Println(m.Company)  // Google
    fmt.Println(m.Level)    // 5
}
```

### 4. å­—æ®µå†²çª

```go
package main

import "fmt"

type A struct {
    Name string
}

type B struct {
    Name string
}

type C struct {
    A
    B
}

func main() {
    c := C{
        A: A{Name: "A"},
        B: B{Name: "B"},
    }
    
    // å¿…é¡»æ˜ç¡®æŒ‡å®š
    fmt.Println(c.A.Name)  // A
    fmt.Println(c.B.Name)  // B
    
    // fmt.Println(c.Name)  // ç¼–è¯‘é”™è¯¯ï¼šambiguous selector c.Name
}
```

---

## ç»“æ„ä½“æ ‡ç­¾

### 1. åŸºæœ¬ç”¨æ³•

```go
package main

import (
    "encoding/json"
    "fmt"
)

type Person struct {
    Name  string `json:"name"`
    Age   int    `json:"age"`
    Email string `json:"email,omitempty"`
}

func main() {
    p := Person{
        Name: "Alice",
        Age:  25,
    }
    
    // åºåˆ—åŒ–ä¸º JSON
    data, _ := json.Marshal(p)
    fmt.Println(string(data))  // {"name":"Alice","age":25}
    
    // ååºåˆ—åŒ–
    jsonStr := `{"name":"Bob","age":30,"email":"bob@example.com"}`
    var p2 Person
    json.Unmarshal([]byte(jsonStr), &p2)
    fmt.Printf("%+v\n", p2)  // {Name:Bob Age:30 Email:bob@example.com}
}
```

### 2. å¤šä¸ªæ ‡ç­¾

```go
package main

import (
    "encoding/json"
    "encoding/xml"
    "fmt"
)

type Person struct {
    Name  string `json:"name" xml:"name" db:"name"`
    Age   int    `json:"age" xml:"age" db:"age"`
    Email string `json:"email,omitempty" xml:"email,omitempty" db:"email"`
}

func main() {
    p := Person{
        Name:  "Alice",
        Age:   25,
        Email: "alice@example.com",
    }
    
    // JSON
    jsonData, _ := json.Marshal(p)
    fmt.Println("JSON:", string(jsonData))
    
    // XML
    xmlData, _ := xml.Marshal(p)
    fmt.Println("XML:", string(xmlData))
}
```

### 3. æ ‡ç­¾é€‰é¡¹

```go
package main

import (
    "encoding/json"
    "fmt"
)

type Person struct {
    Name     string `json:"name"`                    // é‡å‘½å
    Age      int    `json:"age,omitempty"`           // é›¶å€¼æ—¶å¿½ç•¥
    Password string `json:"-"`                       // å¿½ç•¥å­—æ®µ
    Email    string `json:"email,omitempty,string"`  // å¤šä¸ªé€‰é¡¹
}

func main() {
    p := Person{
        Name:     "Alice",
        Age:      0,
        Password: "secret",
        Email:    "alice@example.com",
    }
    
    data, _ := json.Marshal(p)
    fmt.Println(string(data))  // {"name":"Alice","email":"alice@example.com"}
}
```

### 4. è‡ªå®šä¹‰æ ‡ç­¾

```go
package main

import (
    "fmt"
    "reflect"
)

type Person struct {
    Name string `validate:"required"`
    Age  int    `validate:"min=0,max=150"`
}

func validate(v interface{}) error {
    t := reflect.TypeOf(v)
    val := reflect.ValueOf(v)
    
    for i := 0; i < t.NumField(); i++ {
        field := t.Field(i)
        tag := field.Tag.Get("validate")
        
        if tag != "" {
            fmt.Printf("Field: %s, Tag: %s, Value: %v\n", 
                field.Name, tag, val.Field(i).Interface())
        }
    }
    
    return nil
}

func main() {
    p := Person{
        Name: "Alice",
        Age:  25,
    }
    
    validate(p)
}
```

---

## ç»“æ„ä½“å†…å­˜å¸ƒå±€

### 1. å†…å­˜å¯¹é½

```go
package main

import (
    "fmt"
    "unsafe"
)

type A struct {
    a int8   // 1 å­—èŠ‚
    b int64  // 8 å­—èŠ‚
    c int16  // 2 å­—èŠ‚
}

type B struct {
    a int8   // 1 å­—èŠ‚
    c int16  // 2 å­—èŠ‚
    b int64  // 8 å­—èŠ‚
}

func main() {
    fmt.Println("Size of A:", unsafe.Sizeof(A{}))  // 24
    fmt.Println("Size of B:", unsafe.Sizeof(B{}))  // 16
    
    // A çš„å†…å­˜å¸ƒå±€ï¼š
    // a(1) + padding(7) + b(8) + c(2) + padding(6) = 24
    
    // B çš„å†…å­˜å¸ƒå±€ï¼š
    // a(1) + padding(1) + c(2) + padding(4) + b(8) = 16
}
```

### 2. ç©ºç»“æ„ä½“

```go
package main

import (
    "fmt"
    "unsafe"
)

type Empty struct{}

func main() {
    fmt.Println("Size of Empty:", unsafe.Sizeof(Empty{}))  // 0
    
    // ç©ºç»“æ„ä½“ä¸å ç”¨å†…å­˜
    // å¸¸ç”¨äºï¼š
    // 1. å®ç° Set
    // 2. ä½œä¸º Channel ä¿¡å·
    // 3. æ–¹æ³•æ¥æ”¶è€…
}
```

### 3. å­—æ®µåç§»é‡

```go
package main

import (
    "fmt"
    "unsafe"
)

type Person struct {
    Name string
    Age  int
    City string
}

func main() {
    p := Person{}
    
    fmt.Println("Offset of Name:", unsafe.Offsetof(p.Name))  // 0
    fmt.Println("Offset of Age:", unsafe.Offsetof(p.Age))    // 16
    fmt.Println("Offset of City:", unsafe.Offsetof(p.City))  // 24
    
    fmt.Println("Size of Person:", unsafe.Sizeof(p))  // 40
}
```

---

## ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: é“¾è¡¨èŠ‚ç‚¹

```go
package main

import "fmt"

type ListNode struct {
    Val  int
    Next *ListNode
}

func NewListNode(val int) *ListNode {
    return &ListNode{Val: val}
}

func (head *ListNode) Append(val int) {
    node := NewListNode(val)
    
    if head == nil {
        head = node
        return
    }
    
    current := head
    for current.Next != nil {
        current = current.Next
    }
    current.Next = node
}

func (head *ListNode) Print() {
    current := head
    for current != nil {
        fmt.Print(current.Val, " -> ")
        current = current.Next
    }
    fmt.Println("nil")
}

func main() {
    head := NewListNode(1)
    head.Append(2)
    head.Append(3)
    head.Print()  // 1 -> 2 -> 3 -> nil
}
```

### ç¤ºä¾‹ 2: äºŒå‰æ ‘èŠ‚ç‚¹

```go
package main

import "fmt"

type TreeNode struct {
    Val   int
    Left  *TreeNode
    Right *TreeNode
}

func NewTreeNode(val int) *TreeNode {
    return &TreeNode{Val: val}
}

// å‰åºéå†
func (root *TreeNode) PreOrder() {
    if root == nil {
        return
    }
    fmt.Print(root.Val, " ")
    root.Left.PreOrder()
    root.Right.PreOrder()
}

// ä¸­åºéå†
func (root *TreeNode) InOrder() {
    if root == nil {
        return
    }
    root.Left.InOrder()
    fmt.Print(root.Val, " ")
    root.Right.InOrder()
}

// ååºéå†
func (root *TreeNode) PostOrder() {
    if root == nil {
        return
    }
    root.Left.PostOrder()
    root.Right.PostOrder()
    fmt.Print(root.Val, " ")
}

func main() {
    root := NewTreeNode(1)
    root.Left = NewTreeNode(2)
    root.Right = NewTreeNode(3)
    root.Left.Left = NewTreeNode(4)
    root.Left.Right = NewTreeNode(5)
    
    fmt.Print("å‰åºéå†: ")
    root.PreOrder()
    fmt.Println()
    
    fmt.Print("ä¸­åºéå†: ")
    root.InOrder()
    fmt.Println()
    
    fmt.Print("ååºéå†: ")
    root.PostOrder()
    fmt.Println()
}
```

### ç¤ºä¾‹ 3: é€‰é¡¹æ¨¡å¼

```go
package main

import "fmt"

type Server struct {
    Host    string
    Port    int
    Timeout int
    MaxConn int
}

type Option func(*Server)

func WithHost(host string) Option {
    return func(s *Server) {
        s.Host = host
    }
}

func WithPort(port int) Option {
    return func(s *Server) {
        s.Port = port
    }
}

func WithTimeout(timeout int) Option {
    return func(s *Server) {
        s.Timeout = timeout
    }
}

func WithMaxConn(maxConn int) Option {
    return func(s *Server) {
        s.MaxConn = maxConn
    }
}

func NewServer(opts ...Option) *Server {
    // é»˜è®¤å€¼
    server := &Server{
        Host:    "localhost",
        Port:    8080,
        Timeout: 30,
        MaxConn: 100,
    }
    
    // åº”ç”¨é€‰é¡¹
    for _, opt := range opts {
        opt(server)
    }
    
    return server
}

func main() {
    server := NewServer(
        WithHost("0.0.0.0"),
        WithPort(9000),
        WithTimeout(60),
    )
    
    fmt.Printf("%+v\n", server)
}
```

---

## å¸¸è§é—®é¢˜

### 1. ç»“æ„ä½“æ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Ÿ

**ç­”æ¡ˆï¼š** å€¼ç±»å‹

```go
type Person struct {
    Name string
    Age  int
}

func main() {
    p1 := Person{Name: "Alice", Age: 25}
    p2 := p1  // å¤åˆ¶
    
    p2.Age = 30
    
    fmt.Println(p1.Age)  // 25 (æœªæ”¹å˜)
    fmt.Println(p2.Age)  // 30
}
```

### 2. ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// âœ… ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…
// 1. éœ€è¦ä¿®æ”¹æ¥æ”¶è€…
func (p *Person) SetAge(age int) {
    p.Age = age
}

// 2. æ¥æ”¶è€…æ˜¯å¤§å¯¹è±¡
type BigStruct struct {
    data [1000000]int
}
func (b *BigStruct) Process() {
    // ...
}

// 3. åŒ…å«ä¸å¯å¤åˆ¶å­—æ®µ
type Cache struct {
    mu sync.Mutex
    data map[string]string
}
func (c *Cache) Get(key string) string {
    c.mu.Lock()
    defer c.mu.Unlock()
    return c.data[key]
}

// âœ… ä½¿ç”¨å€¼æ¥æ”¶è€…
// 1. å°å¯¹è±¡ä¸”ä¸éœ€ä¿®æ”¹
type Point struct {
    X, Y int
}
func (p Point) Distance() float64 {
    return math.Sqrt(float64(p.X*p.X + p.Y*p.Y))
}
```

### 3. ç»“æ„ä½“å¯ä»¥æ¯”è¾ƒå—ï¼Ÿ

**ç­”æ¡ˆï¼š** å¯ä»¥ï¼Œä½†æœ‰æ¡ä»¶

```go
// âœ… æ‰€æœ‰å­—æ®µéƒ½å¯æ¯”è¾ƒ
type Person struct {
    Name string
    Age  int
}

p1 := Person{"Alice", 25}
p2 := Person{"Alice", 25}
fmt.Println(p1 == p2)  // true

// âŒ åŒ…å«ä¸å¯æ¯”è¾ƒå­—æ®µ
type Student struct {
    Name   string
    Scores []int  // åˆ‡ç‰‡ä¸å¯æ¯”è¾ƒ
}

s1 := Student{"Alice", []int{90, 85}}
s2 := Student{"Alice", []int{90, 85}}
// fmt.Println(s1 == s2)  // ç¼–è¯‘é”™è¯¯
```

### 4. åŒ¿ååµŒå…¥å’Œå‘½ååµŒå…¥çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// åŒ¿ååµŒå…¥ï¼šå¯ä»¥ç›´æ¥è®¿é—®åµŒå…¥ç±»å‹çš„å­—æ®µå’Œæ–¹æ³•
type Student struct {
    Person  // åŒ¿å
    School string
}

s := Student{}
s.Name = "Alice"  // âœ… ç›´æ¥è®¿é—®

// å‘½ååµŒå…¥ï¼šå¿…é¡»é€šè¿‡å­—æ®µåè®¿é—®
type Student struct {
    person Person  // å‘½å
    School string
}

s := Student{}
s.person.Name = "Alice"  // âœ… é€šè¿‡å­—æ®µåè®¿é—®
// s.Name = "Alice"  // âŒ ç¼–è¯‘é”™è¯¯
```

---

## é¢è¯•é¢˜

### 1. ä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ

```go
type Person struct {
    Name string
    Age  int
}

func (p Person) SetAge(age int) {
    p.Age = age
}

func main() {
    p := Person{Name: "Alice", Age: 25}
    p.SetAge(30)
    fmt.Println(p.Age)
}
```

**ç­”æ¡ˆï¼š** 25

**è§£æï¼š** å€¼æ¥æ”¶è€…ä¸èƒ½ä¿®æ”¹åŸå¯¹è±¡

### 2. å¦‚ä½•å®ç°ç»“æ„ä½“çš„æ·±æ‹·è´ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
type Person struct {
    Name   string
    Age    int
    Scores []int
}

// æ–¹æ³• 1: æ‰‹åŠ¨å¤åˆ¶
func (p Person) Clone() Person {
    scores := make([]int, len(p.Scores))
    copy(scores, p.Scores)
    
    return Person{
        Name:   p.Name,
        Age:    p.Age,
        Scores: scores,
    }
}

// æ–¹æ³• 2: ä½¿ç”¨ JSON
func (p Person) CloneByJSON() (Person, error) {
    data, err := json.Marshal(p)
    if err != nil {
        return Person{}, err
    }
    
    var clone Person
    err = json.Unmarshal(data, &clone)
    return clone, err
}
```

### 3. ç©ºç»“æ„ä½“æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// 1. å®ç° Set
set := make(map[string]struct{})
set["key"] = struct{}{}

// 2. ä½œä¸º Channel ä¿¡å·
done := make(chan struct{})
go func() {
    // do something
    done <- struct{}{}
}()
<-done

// 3. æ–¹æ³•æ¥æ”¶è€…
type Handler struct{}
func (h Handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    // ...
}
```

### 4. ç»“æ„ä½“æ ‡ç­¾çš„ä½œç”¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// 1. JSON åºåˆ—åŒ–
type Person struct {
    Name string `json:"name"`
    Age  int    `json:"age,omitempty"`
}

// 2. æ•°æ®åº“æ˜ å°„
type User struct {
    ID   int    `db:"id"`
    Name string `db:"name"`
}

// 3. æ•°æ®éªŒè¯
type Form struct {
    Email string `validate:"required,email"`
    Age   int    `validate:"min=0,max=150"`
}
```

### 5. å¦‚ä½•ä¼˜åŒ–ç»“æ„ä½“å†…å­˜å¸ƒå±€ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// âŒ ä¸æ¨èï¼ˆ24 å­—èŠ‚ï¼‰
type Bad struct {
    a int8   // 1 + 7 padding
    b int64  // 8
    c int16  // 2 + 6 padding
}

// âœ… æ¨èï¼ˆ16 å­—èŠ‚ï¼‰
type Good struct {
    b int64  // 8
    c int16  // 2
    a int8   // 1 + 5 padding
}

// åŸåˆ™ï¼šæŒ‰å­—æ®µå¤§å°é™åºæ’åˆ—
```

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨æ„é€ å‡½æ•°

```go
// âœ… æ¨è
func NewPerson(name string, age int) *Person {
    return &Person{
        Name: name,
        Age:  age,
    }
}

// âŒ ä¸æ¨è
p := &Person{Name: "Alice", Age: 25}
```

### 2. ä¼˜å…ˆä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…

```go
// âœ… æ¨èï¼ˆä¸€è‡´æ€§ï¼‰
func (p *Person) GetName() string {
    return p.Name
}

func (p *Person) SetName(name string) {
    p.Name = name
}
```

### 3. å­—æ®µæŒ‰å¤§å°æ’åº

```go
// âœ… æ¨è
type Person struct {
    Name   string  // 16
    Age    int64   // 8
    Active bool    // 1
}
```

### 4. ä½¿ç”¨é€‰é¡¹æ¨¡å¼

```go
// âœ… æ¨èï¼ˆçµæ´»ã€å¯æ‰©å±•ï¼‰
func NewServer(opts ...Option) *Server

// âŒ ä¸æ¨èï¼ˆå‚æ•°è¿‡å¤šï¼‰
func NewServer(host string, port int, timeout int, ...)
```

### 5. å¯¼å‡ºå¿…è¦çš„å­—æ®µ

```go
// âœ… æ¨è
type Person struct {
    Name   string  // å¯¼å‡º
    Age    int     // å¯¼å‡º
    salary float64 // ä¸å¯¼å‡º
}
```

---

## å‚è€ƒèµ„æ–™

- [x] [Go å®˜æ–¹æ–‡æ¡£ - Structs](https://go.dev/ref/spec#Struct_types)
- [x] [Effective Go - Composite literals](https://go.dev/doc/effective_go#composite_literals)
- [x] [Go by Example - Structs](https://gobyexample.com/structs)
- [x] [Go by Example - Methods](https://gobyexample.com/methods)
- [x] [ç»“æ„ä½“å†…å­˜å¯¹é½](https://dave.cheney.net/2015/10/09/padding-is-hard)

---

**ä¸‹ä¸€èŠ‚ï¼š** [09-æ¥å£](./09-æ¥å£.md)
