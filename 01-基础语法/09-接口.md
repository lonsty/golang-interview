# 09-æ¥å£

[â† è¿”å›æœ¬ç« ç›®å½•](./README.md) | [â† è¿”å›æ€»ç›®å½•](../README.md)

---

## ğŸ“‹ ç›®å½•

- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [æ¥å£å®šä¹‰](#æ¥å£å®šä¹‰)
- [æ¥å£å®ç°](#æ¥å£å®ç°)
- [æ¥å£ç»„åˆ](#æ¥å£ç»„åˆ)
- [ç±»å‹æ–­è¨€](#ç±»å‹æ–­è¨€)
- [ç©ºæ¥å£](#ç©ºæ¥å£)
- [æ¥å£åº•å±‚å®ç°](#æ¥å£åº•å±‚å®ç°)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [é¢è¯•é¢˜](#é¢è¯•é¢˜)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)

---

## æ ¸å¿ƒæ¦‚å¿µ

æ¥å£ï¼ˆinterfaceï¼‰æ˜¯ Go è¯­è¨€å®ç°å¤šæ€çš„æ ¸å¿ƒæœºåˆ¶ã€‚

```
ç‰¹ç‚¹ï¼š
1. éšå¼å®ç°ï¼ˆé¸­å­ç±»å‹ï¼‰
2. æ¥å£æ˜¯ç±»å‹
3. æ¥å£å€¼åŒ…å«ç±»å‹å’Œå€¼
4. ç©ºæ¥å£å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹
5. æ¥å£ç»„åˆ
```

### æ¥å£çš„ä½œç”¨

- **è§£è€¦**ï¼šä¾èµ–æ¥å£è€Œéå…·ä½“å®ç°
- **å¤šæ€**ï¼šä¸åŒç±»å‹å®ç°ç›¸åŒæ¥å£
- **æµ‹è¯•**ï¼šæ–¹ä¾¿ Mock å’Œæµ‹è¯•
- **æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°å®ç°

---

## æ¥å£å®šä¹‰

### 1. åŸºæœ¬å®šä¹‰

```go
package main

import "fmt"

// å®šä¹‰æ¥å£
type Animal interface {
    Speak() string
}

// å®ç°æ¥å£
type Dog struct {
    Name string
}

func (d Dog) Speak() string {
    return "Woof!"
}

type Cat struct {
    Name string
}

func (c Cat) Speak() string {
    return "Meow!"
}

func main() {
    var animal Animal
    
    animal = Dog{Name: "Buddy"}
    fmt.Println(animal.Speak())  // Woof!
    
    animal = Cat{Name: "Kitty"}
    fmt.Println(animal.Speak())  // Meow!
}
```

### 2. æ¥å£å‘½åè§„èŒƒ

```go
// å•æ–¹æ³•æ¥å£ï¼šä»¥ er ç»“å°¾
type Reader interface {
    Read(p []byte) (n int, err error)
}

type Writer interface {
    Write(p []byte) (n int, err error)
}

type Closer interface {
    Close() error
}

// å¤šæ–¹æ³•æ¥å£ï¼šæè¿°æ€§åç§°
type ReadWriter interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
}
```

### 3. æ¥å£åµŒå…¥

```go
package main

import "io"

// æ¥å£ç»„åˆ
type ReadWriteCloser interface {
    io.Reader
    io.Writer
    io.Closer
}

// ç­‰ä»·äº
type ReadWriteCloser2 interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
    Close() error
}
```

---

## æ¥å£å®ç°

### 1. éšå¼å®ç°

```go
package main

import "fmt"

type Speaker interface {
    Speak() string
}

type Person struct {
    Name string
}

// åªè¦å®ç°äº† Speak æ–¹æ³•ï¼Œå°±å®ç°äº† Speaker æ¥å£
func (p Person) Speak() string {
    return "Hello, I'm " + p.Name
}

func main() {
    var s Speaker = Person{Name: "Alice"}
    fmt.Println(s.Speak())
}
```

### 2. å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…

```go
package main

import "fmt"

type Counter interface {
    Increment()
    Value() int
}

type MyCounter struct {
    count int
}

// æŒ‡é’ˆæ¥æ”¶è€…
func (c *MyCounter) Increment() {
    c.count++
}

// å€¼æ¥æ”¶è€…
func (c MyCounter) Value() int {
    return c.count
}

func main() {
    var c Counter
    
    // âœ… æŒ‡é’ˆå®ç°äº†æ¥å£
    c = &MyCounter{}
    c.Increment()
    fmt.Println(c.Value())
    
    // âŒ å€¼ç±»å‹æ²¡æœ‰å®Œå…¨å®ç°æ¥å£ï¼ˆIncrement æ˜¯æŒ‡é’ˆæ¥æ”¶è€…ï¼‰
    // c = MyCounter{}  // ç¼–è¯‘é”™è¯¯
}
```

### 3. æ¥å£å®ç°æ£€æŸ¥

```go
package main

import "io"

type MyWriter struct{}

func (w *MyWriter) Write(p []byte) (n int, err error) {
    return len(p), nil
}

// ç¼–è¯‘æ—¶æ£€æŸ¥æ˜¯å¦å®ç°äº†æ¥å£
var _ io.Writer = (*MyWriter)(nil)

func main() {
    // ...
}
```

---

## æ¥å£ç»„åˆ

### 1. æ ‡å‡†åº“ç¤ºä¾‹

```go
package main

import "io"

// io.ReadWriter ç»„åˆäº† Reader å’Œ Writer
type ReadWriter interface {
    Reader
    Writer
}

// io.ReadWriteCloser ç»„åˆäº†ä¸‰ä¸ªæ¥å£
type ReadWriteCloser interface {
    Reader
    Writer
    Closer
}
```

### 2. è‡ªå®šä¹‰ç»„åˆ

```go
package main

type DataStore interface {
    Get(key string) (string, error)
    Set(key, value string) error
}

type Cache interface {
    Clear() error
}

// ç»„åˆæ¥å£
type CachedDataStore interface {
    DataStore
    Cache
}
```

---

## ç±»å‹æ–­è¨€

### 1. åŸºæœ¬ç±»å‹æ–­è¨€

```go
package main

import "fmt"

func main() {
    var i interface{} = "hello"
    
    // ç±»å‹æ–­è¨€
    s := i.(string)
    fmt.Println(s)  // hello
    
    // å®‰å…¨çš„ç±»å‹æ–­è¨€
    s, ok := i.(string)
    fmt.Println(s, ok)  // hello true
    
    n, ok := i.(int)
    fmt.Println(n, ok)  // 0 false
}
```

### 2. ç±»å‹é€‰æ‹©

```go
package main

import "fmt"

func describe(i interface{}) {
    switch v := i.(type) {
    case int:
        fmt.Printf("æ•´æ•°: %d\n", v)
    case string:
        fmt.Printf("å­—ç¬¦ä¸²: %s\n", v)
    case bool:
        fmt.Printf("å¸ƒå°”: %t\n", v)
    default:
        fmt.Printf("æœªçŸ¥ç±»å‹: %T\n", v)
    }
}

func main() {
    describe(42)
    describe("hello")
    describe(true)
    describe(3.14)
}
```

---

## ç©ºæ¥å£

### 1. ç©ºæ¥å£å®šä¹‰

```go
package main

import "fmt"

func main() {
    // ç©ºæ¥å£å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹
    var i interface{}
    
    i = 42
    fmt.Println(i)
    
    i = "hello"
    fmt.Println(i)
    
    i = true
    fmt.Println(i)
}
```

### 2. ç©ºæ¥å£åº”ç”¨

```go
package main

import "fmt"

// æ¥å—ä»»æ„ç±»å‹å‚æ•°
func Print(v interface{}) {
    fmt.Println(v)
}

// è¿”å›ä»»æ„ç±»å‹
func Get(key string) interface{} {
    // ...
    return "value"
}

// å­˜å‚¨ä»»æ„ç±»å‹
type Container struct {
    data []interface{}
}

func (c *Container) Add(v interface{}) {
    c.data = append(c.data, v)
}

func main() {
    Print(42)
    Print("hello")
    
    c := &Container{}
    c.Add(1)
    c.Add("two")
    c.Add(true)
}
```

---

## æ¥å£åº•å±‚å®ç°

### 1. æ¥å£ç»“æ„

```go
// éç©ºæ¥å£ï¼ˆifaceï¼‰
type iface struct {
    tab  *itab           // ç±»å‹ä¿¡æ¯
    data unsafe.Pointer  // æ•°æ®æŒ‡é’ˆ
}

type itab struct {
    inter *interfacetype  // æ¥å£ç±»å‹
    _type *_type          // å®é™…ç±»å‹
    hash  uint32          // ç±»å‹å“ˆå¸Œ
    _     [4]byte
    fun   [1]uintptr      // æ–¹æ³•è¡¨
}

// ç©ºæ¥å£ï¼ˆefaceï¼‰
type eface struct {
    _type *_type         // ç±»å‹ä¿¡æ¯
    data  unsafe.Pointer // æ•°æ®æŒ‡é’ˆ
}
```

### 2. nil æ¥å£

```go
package main

import "fmt"

func main() {
    var i interface{}
    fmt.Println(i == nil)  // true
    
    var p *int
    i = p
    fmt.Println(i == nil)  // falseï¼ˆç±»å‹ä¸ä¸º nilï¼‰
}
```

---

## æ¥å£è®¾è®¡åŸåˆ™

### 1. æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰

```go
// âŒ ä¸æ¨èï¼šæ¥å£è¿‡å¤§
type Worker interface {
    Work()
    Eat()
    Sleep()
}

// âœ… æ¨èï¼šæ¥å£åˆ†ç¦»
type Worker interface {
    Work()
}

type Eater interface {
    Eat()
}

type Sleeper interface {
    Sleep()
}

// ç»„åˆä½¿ç”¨
type Human interface {
    Worker
    Eater
    Sleeper
}
```

### 2. ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰

```go
// âœ… é«˜å±‚æ¨¡å—ä¾èµ–æ¥å£ï¼Œè€Œéå…·ä½“å®ç°
package main

import "fmt"

// å®šä¹‰æ¥å£ï¼ˆæŠ½è±¡ï¼‰
type MessageSender interface {
    Send(message string) error
}

// å…·ä½“å®ç° 1
type EmailSender struct{}

func (e EmailSender) Send(message string) error {
    fmt.Println("å‘é€é‚®ä»¶:", message)
    return nil
}

// å…·ä½“å®ç° 2
type SMSSender struct{}

func (s SMSSender) Send(message string) error {
    fmt.Println("å‘é€çŸ­ä¿¡:", message)
    return nil
}

// é«˜å±‚æ¨¡å—ä¾èµ–æ¥å£
type NotificationService struct {
    sender MessageSender
}

func NewNotificationService(sender MessageSender) *NotificationService {
    return &NotificationService{sender: sender}
}

func (n *NotificationService) Notify(message string) error {
    return n.sender.Send(message)
}

func main() {
    // å¯ä»¥è½»æ¾åˆ‡æ¢å®ç°
    service1 := NewNotificationService(EmailSender{})
    service1.Notify("Hello via Email")
    
    service2 := NewNotificationService(SMSSender{})
    service2.Notify("Hello via SMS")
}
```

### 3. é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰

```go
package main

import "fmt"

type Bird interface {
    Fly() string
}

type Sparrow struct{}

func (s Sparrow) Fly() string {
    return "éº»é›€åœ¨é£"
}

type Eagle struct{}

func (e Eagle) Fly() string {
    return "è€é¹°åœ¨é£"
}

// ä»»ä½• Bird çš„å®ç°éƒ½å¯ä»¥æ›¿æ¢
func LetBirdFly(b Bird) {
    fmt.Println(b.Fly())
}

func main() {
    LetBirdFly(Sparrow{})
    LetBirdFly(Eagle{})
}
```

---

## é«˜çº§ç”¨æ³•

### 1. æ¥å£åµŒå¥—

```go
package main

import "io"

// æ ‡å‡†åº“ä¸­çš„æ¥å£åµŒå¥—
type ReadWriteCloser interface {
    io.Reader
    io.Writer
    io.Closer
}

// è‡ªå®šä¹‰æ¥å£åµŒå¥—
type DataStore interface {
    Get(key string) (interface{}, error)
    Set(key string, value interface{}) error
}

type Cache interface {
    Clear() error
    Size() int
}

type CachedDataStore interface {
    DataStore
    Cache
}
```

### 2. æ¥å£ç±»å‹æ–­è¨€ä¸ç±»å‹é€‰æ‹©

```go
package main

import "fmt"

func process(i interface{}) {
    // ç±»å‹æ–­è¨€
    if str, ok := i.(string); ok {
        fmt.Println("å­—ç¬¦ä¸²:", str)
        return
    }
    
    // ç±»å‹é€‰æ‹©
    switch v := i.(type) {
    case int:
        fmt.Println("æ•´æ•°:", v)
    case float64:
        fmt.Println("æµ®ç‚¹æ•°:", v)
    case bool:
        fmt.Println("å¸ƒå°”:", v)
    case []int:
        fmt.Println("æ•´æ•°åˆ‡ç‰‡:", v)
    case map[string]int:
        fmt.Println("å­—ç¬¦ä¸²åˆ°æ•´æ•°çš„æ˜ å°„:", v)
    default:
        fmt.Printf("æœªçŸ¥ç±»å‹: %T\n", v)
    }
}

func main() {
    process(42)
    process(3.14)
    process("hello")
    process(true)
    process([]int{1, 2, 3})
    process(map[string]int{"a": 1})
}
```

### 3. æ¥å£ä¸åå°„

```go
package main

import (
    "fmt"
    "reflect"
)

func inspectInterface(i interface{}) {
    t := reflect.TypeOf(i)
    v := reflect.ValueOf(i)
    
    fmt.Printf("ç±»å‹: %v\n", t)
    fmt.Printf("å€¼: %v\n", v)
    fmt.Printf("ç§ç±»: %v\n", t.Kind())
    
    // å¦‚æœæ˜¯æ¥å£ç±»å‹
    if t.Kind() == reflect.Interface {
        fmt.Println("è¿™æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹")
    }
}

func main() {
    var i interface{} = 42
    inspectInterface(i)
    
    var s interface{} = "hello"
    inspectInterface(s)
}
```

### 4. å‡½æ•°ç±»å‹å®ç°æ¥å£

```go
package main

import (
    "fmt"
    "net/http"
)

// http.Handler æ¥å£
// type Handler interface {
//     ServeHTTP(ResponseWriter, *Request)
// }

// å‡½æ•°ç±»å‹
type HandlerFunc func(http.ResponseWriter, *http.Request)

// å‡½æ•°ç±»å‹å®ç°æ¥å£
func (f HandlerFunc) ServeHTTP(w http.ResponseWriter, r *http.Request) {
    f(w, r)
}

func helloHandler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, "Hello, World!")
}

func main() {
    // å°†å‡½æ•°è½¬æ¢ä¸ºæ¥å£ç±»å‹
    var handler http.Handler = HandlerFunc(helloHandler)
    
    http.Handle("/", handler)
    // http.ListenAndServe(":8080", nil)
}
```

---

## ä»£ç ç¤ºä¾‹

### ç¤ºä¾‹ 1: å¤šæ€

```go
package main

import (
    "fmt"
    "math"
)

type Shape interface {
    Area() float64
    Perimeter() float64
}

type Rectangle struct {
    Width, Height float64
}

func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

func (r Rectangle) Perimeter() float64 {
    return 2 * (r.Width + r.Height)
}

type Circle struct {
    Radius float64
}

func (c Circle) Area() float64 {
    return math.Pi * c.Radius * c.Radius
}

func (c Circle) Perimeter() float64 {
    return 2 * math.Pi * c.Radius
}

type Triangle struct {
    A, B, C float64
}

func (t Triangle) Area() float64 {
    // æµ·ä¼¦å…¬å¼
    s := (t.A + t.B + t.C) / 2
    return math.Sqrt(s * (s - t.A) * (s - t.B) * (s - t.C))
}

func (t Triangle) Perimeter() float64 {
    return t.A + t.B + t.C
}

func PrintShapeInfo(s Shape) {
    fmt.Printf("é¢ç§¯: %.2f, å‘¨é•¿: %.2f\n", s.Area(), s.Perimeter())
}

func main() {
    shapes := []Shape{
        Rectangle{Width: 10, Height: 5},
        Circle{Radius: 5},
        Triangle{A: 3, B: 4, C: 5},
    }
    
    for i, shape := range shapes {
        fmt.Printf("å½¢çŠ¶ %d: ", i+1)
        PrintShapeInfo(shape)
    }
}
```

### ç¤ºä¾‹ 2: ä¾èµ–æ³¨å…¥

```go
package main

import (
    "fmt"
    "time"
)

// å®šä¹‰æ¥å£
type Database interface {
    Query(sql string) ([]string, error)
    Close() error
}

type Cache interface {
    Get(key string) (string, bool)
    Set(key, value string)
}

// MySQL å®ç°
type MySQL struct {
    connected bool
}

func NewMySQL() *MySQL {
    return &MySQL{connected: true}
}

func (m *MySQL) Query(sql string) ([]string, error) {
    if !m.connected {
        return nil, fmt.Errorf("æ•°æ®åº“æœªè¿æ¥")
    }
    return []string{"result from MySQL: " + sql}, nil
}

func (m *MySQL) Close() error {
    m.connected = false
    return nil
}

// Redis ç¼“å­˜å®ç°
type RedisCache struct {
    data map[string]string
}

func NewRedisCache() *RedisCache {
    return &RedisCache{
        data: make(map[string]string),
    }
}

func (r *RedisCache) Get(key string) (string, bool) {
    val, ok := r.data[key]
    return val, ok
}

func (r *RedisCache) Set(key, value string) {
    r.data[key] = value
}

// ç”¨æˆ·æœåŠ¡ï¼ˆä¾èµ–æ¥å£ï¼‰
type UserService struct {
    db    Database
    cache Cache
}

func NewUserService(db Database, cache Cache) *UserService {
    return &UserService{
        db:    db,
        cache: cache,
    }
}

func (s *UserService) GetUser(id string) (string, error) {
    // å…ˆæŸ¥ç¼“å­˜
    if val, ok := s.cache.Get(id); ok {
        fmt.Println("ä»ç¼“å­˜è·å–")
        return val, nil
    }
    
    // æŸ¥æ•°æ®åº“
    fmt.Println("ä»æ•°æ®åº“è·å–")
    results, err := s.db.Query("SELECT * FROM users WHERE id = " + id)
    if err != nil {
        return "", err
    }
    
    if len(results) > 0 {
        // å†™å…¥ç¼“å­˜
        s.cache.Set(id, results[0])
        return results[0], nil
    }
    
    return "", fmt.Errorf("ç”¨æˆ·ä¸å­˜åœ¨")
}

func main() {
    db := NewMySQL()
    cache := NewRedisCache()
    service := NewUserService(db, cache)
    
    // ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ˆä»æ•°æ®åº“ï¼‰
    user, _ := service.GetUser("123")
    fmt.Println("ç”¨æˆ·:", user)
    
    // ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆä»ç¼“å­˜ï¼‰
    user, _ = service.GetUser("123")
    fmt.Println("ç”¨æˆ·:", user)
}
```

### ç¤ºä¾‹ 3: ç­–ç•¥æ¨¡å¼

```go
package main

import "fmt"

// æ”¯ä»˜ç­–ç•¥æ¥å£
type PaymentStrategy interface {
    Pay(amount float64) error
}

// æ”¯ä»˜å®æ”¯ä»˜
type AlipayPayment struct {
    Account string
}

func (a AlipayPayment) Pay(amount float64) error {
    fmt.Printf("ä½¿ç”¨æ”¯ä»˜å®è´¦æˆ· %s æ”¯ä»˜ %.2f å…ƒ\n", a.Account, amount)
    return nil
}

// å¾®ä¿¡æ”¯ä»˜
type WeChatPayment struct {
    Account string
}

func (w WeChatPayment) Pay(amount float64) error {
    fmt.Printf("ä½¿ç”¨å¾®ä¿¡è´¦æˆ· %s æ”¯ä»˜ %.2f å…ƒ\n", w.Account, amount)
    return nil
}

// ä¿¡ç”¨å¡æ”¯ä»˜
type CreditCardPayment struct {
    CardNumber string
}

func (c CreditCardPayment) Pay(amount float64) error {
    fmt.Printf("ä½¿ç”¨ä¿¡ç”¨å¡ %s æ”¯ä»˜ %.2f å…ƒ\n", c.CardNumber, amount)
    return nil
}

// æ”¯ä»˜ä¸Šä¸‹æ–‡
type PaymentContext struct {
    strategy PaymentStrategy
}

func NewPaymentContext(strategy PaymentStrategy) *PaymentContext {
    return &PaymentContext{strategy: strategy}
}

func (p *PaymentContext) SetStrategy(strategy PaymentStrategy) {
    p.strategy = strategy
}

func (p *PaymentContext) ExecutePayment(amount float64) error {
    return p.strategy.Pay(amount)
}

func main() {
    // ä½¿ç”¨æ”¯ä»˜å®
    ctx := NewPaymentContext(AlipayPayment{Account: "user@alipay.com"})
    ctx.ExecutePayment(100.00)
    
    // åˆ‡æ¢åˆ°å¾®ä¿¡æ”¯ä»˜
    ctx.SetStrategy(WeChatPayment{Account: "user@wechat.com"})
    ctx.ExecutePayment(200.00)
    
    // åˆ‡æ¢åˆ°ä¿¡ç”¨å¡æ”¯ä»˜
    ctx.SetStrategy(CreditCardPayment{CardNumber: "1234-5678-9012-3456"})
    ctx.ExecutePayment(300.00)
}
```

### ç¤ºä¾‹ 4: é€‚é…å™¨æ¨¡å¼

```go
package main

import "fmt"

// ç›®æ ‡æ¥å£
type Target interface {
    Request() string
}

// éœ€è¦é€‚é…çš„ç±»
type Adaptee struct{}

func (a *Adaptee) SpecificRequest() string {
    return "Adaptee çš„ç‰¹æ®Šè¯·æ±‚"
}

// é€‚é…å™¨
type Adapter struct {
    adaptee *Adaptee
}

func NewAdapter(adaptee *Adaptee) *Adapter {
    return &Adapter{adaptee: adaptee}
}

func (a *Adapter) Request() string {
    return "é€‚é…å™¨è½¬æ¢: " + a.adaptee.SpecificRequest()
}

func main() {
    adaptee := &Adaptee{}
    adapter := NewAdapter(adaptee)
    
    var target Target = adapter
    fmt.Println(target.Request())
}
```

### ç¤ºä¾‹ 5: Mock æµ‹è¯•

```go
package main

import (
    "fmt"
    "testing"
)

// å®šä¹‰æ¥å£
type EmailSender interface {
    SendEmail(to, subject, body string) error
}

// çœŸå®å®ç°
type RealEmailSender struct{}

func (r *RealEmailSender) SendEmail(to, subject, body string) error {
    // å®é™…å‘é€é‚®ä»¶çš„é€»è¾‘
    fmt.Printf("å‘é€é‚®ä»¶åˆ° %s\n", to)
    return nil
}

// Mock å®ç°ï¼ˆç”¨äºæµ‹è¯•ï¼‰
type MockEmailSender struct {
    SendEmailCalled bool
    SendEmailTo     string
    SendEmailError  error
}

func (m *MockEmailSender) SendEmail(to, subject, body string) error {
    m.SendEmailCalled = true
    m.SendEmailTo = to
    return m.SendEmailError
}

// ä¸šåŠ¡é€»è¾‘
type UserService struct {
    emailSender EmailSender
}

func NewUserService(sender EmailSender) *UserService {
    return &UserService{emailSender: sender}
}

func (s *UserService) RegisterUser(email string) error {
    // æ³¨å†Œé€»è¾‘...
    
    // å‘é€æ¬¢è¿é‚®ä»¶
    return s.emailSender.SendEmail(email, "æ¬¢è¿", "æ¬¢è¿æ³¨å†Œ")
}

// æµ‹è¯•
func TestUserService_RegisterUser(t *testing.T) {
    // ä½¿ç”¨ Mock
    mockSender := &MockEmailSender{}
    service := NewUserService(mockSender)
    
    err := service.RegisterUser("test@example.com")
    
    if err != nil {
        t.Errorf("æ³¨å†Œå¤±è´¥: %v", err)
    }
    
    if !mockSender.SendEmailCalled {
        t.Error("SendEmail æœªè¢«è°ƒç”¨")
    }
    
    if mockSender.SendEmailTo != "test@example.com" {
        t.Errorf("é‚®ä»¶å‘é€åˆ°é”™è¯¯çš„åœ°å€: %s", mockSender.SendEmailTo)
    }
}

func main() {
    // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çœŸå®å®ç°
    realService := NewUserService(&RealEmailSender{})
    realService.RegisterUser("user@example.com")
    
    // æµ‹è¯•ç¯å¢ƒä½¿ç”¨ Mock
    mockSender := &MockEmailSender{}
    testService := NewUserService(mockSender)
    testService.RegisterUser("test@example.com")
    
    fmt.Printf("Mock è¢«è°ƒç”¨: %v\n", mockSender.SendEmailCalled)
}
```

---

## å¸¸è§é—®é¢˜

### 1. æ¥å£æ˜¯å€¼ç±»å‹è¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Ÿ

**ç­”æ¡ˆï¼š** æ¥å£æ˜¯å¼•ç”¨ç±»å‹ï¼ˆåŒ…å«ç±»å‹å’Œæ•°æ®æŒ‡é’ˆï¼‰

### 2. nil æ¥å£å’Œæ¥å£å€¼ä¸º nil çš„åŒºåˆ«ï¼Ÿ

```go
var i interface{}     // nil æ¥å£ï¼ˆç±»å‹å’Œå€¼éƒ½ä¸º nilï¼‰
var p *int
i = p                 // æ¥å£å€¼ä¸º nilï¼ˆç±»å‹ä¸ä¸º nilï¼Œå€¼ä¸º nilï¼‰
```

### 3. å¦‚ä½•åˆ¤æ–­æ¥å£æ˜¯å¦å®ç°ï¼Ÿ

```go
// ç¼–è¯‘æ—¶æ£€æŸ¥
var _ io.Writer = (*MyWriter)(nil)

// è¿è¡Œæ—¶æ£€æŸ¥
if _, ok := i.(io.Writer); ok {
    // å®ç°äº† io.Writer
}
```

---

## é¢è¯•é¢˜

### 1. æ¥å£çš„åº•å±‚å®ç°æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆï¼š**

Go è¯­è¨€ä¸­æ¥å£æœ‰ä¸¤ç§åº•å±‚å®ç°ï¼š

**1. ifaceï¼ˆéç©ºæ¥å£ï¼‰**
```go
type iface struct {
    tab  *itab           // ç±»å‹ä¿¡æ¯å’Œæ–¹æ³•è¡¨
    data unsafe.Pointer  // æŒ‡å‘å®é™…æ•°æ®
}

type itab struct {
    inter *interfacetype  // æ¥å£ç±»å‹
    _type *_type          // å®é™…ç±»å‹
    hash  uint32          // ç±»å‹å“ˆå¸Œ
    fun   [1]uintptr      // æ–¹æ³•è¡¨ï¼ˆåŠ¨æ€å¤§å°ï¼‰
}
```

**2. efaceï¼ˆç©ºæ¥å£ï¼‰**
```go
type eface struct {
    _type *_type         // ç±»å‹ä¿¡æ¯
    data  unsafe.Pointer // æŒ‡å‘å®é™…æ•°æ®
}
```

**åŒºåˆ«ï¼š**
- iface åŒ…å«æ–¹æ³•è¡¨ï¼Œç”¨äºéç©ºæ¥å£
- eface ä¸åŒ…å«æ–¹æ³•è¡¨ï¼Œç”¨äºç©ºæ¥å£ `interface{}`

### 2. å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…å®ç°æ¥å£çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
type Counter interface {
    Increment()
    Value() int
}

type MyCounter struct {
    count int
}

// æŒ‡é’ˆæ¥æ”¶è€…
func (c *MyCounter) Increment() {
    c.count++
}

// å€¼æ¥æ”¶è€…
func (c MyCounter) Value() int {
    return c.count
}

func main() {
    var c Counter
    
    // âœ… æŒ‡é’ˆå¯ä»¥è°ƒç”¨æ‰€æœ‰æ–¹æ³•
    c = &MyCounter{}
    c.Increment()
    
    // âŒ å€¼ç±»å‹ä¸èƒ½è°ƒç”¨æŒ‡é’ˆæ¥æ”¶è€…æ–¹æ³•
    // c = MyCounter{}  // ç¼–è¯‘é”™è¯¯
}
```

**è§„åˆ™ï¼š**
- **å€¼æ¥æ”¶è€…**ï¼šå€¼å’ŒæŒ‡é’ˆéƒ½å¯ä»¥è°ƒç”¨
- **æŒ‡é’ˆæ¥æ”¶è€…**ï¼šåªæœ‰æŒ‡é’ˆå¯ä»¥è°ƒç”¨
- **åŸå› **ï¼šGo å¯ä»¥è‡ªåŠ¨è·å–å€¼çš„åœ°å€ï¼Œä½†ä¸èƒ½è‡ªåŠ¨è§£å¼•ç”¨æ¥å£ä¸­çš„æŒ‡é’ˆ

### 3. æ¥å£çš„é›¶å€¼æ˜¯ä»€ä¹ˆï¼Ÿnil æ¥å£å’Œæ¥å£å€¼ä¸º nil æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
// 1. nil æ¥å£ï¼ˆç±»å‹å’Œå€¼éƒ½ä¸º nilï¼‰
var i interface{}
fmt.Println(i == nil)  // true

// 2. æ¥å£å€¼ä¸º nilï¼ˆç±»å‹ä¸ä¸º nilï¼Œå€¼ä¸º nilï¼‰
var p *int
i = p
fmt.Println(i == nil)  // false
fmt.Println(i == (*int)(nil))  // true

// åˆ¤æ–­æ¥å£æ˜¯å¦çœŸæ­£ä¸º nil
func isNil(i interface{}) bool {
    return i == nil || reflect.ValueOf(i).IsNil()
}
```

**åŒºåˆ«ï¼š**
- **nil æ¥å£**ï¼šç±»å‹å’Œå€¼éƒ½ä¸º nilï¼Œ`i == nil` è¿”å› true
- **æ¥å£å€¼ä¸º nil**ï¼šç±»å‹ä¸ä¸º nilï¼Œå€¼ä¸º nilï¼Œ`i == nil` è¿”å› false

### 4. å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»å‹æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ–¹æ³• 1ï¼šç¼–è¯‘æ—¶æ£€æŸ¥**
```go
var _ io.Writer = (*MyWriter)(nil)
var _ io.Reader = (*MyReader)(nil)
```

**æ–¹æ³• 2ï¼šè¿è¡Œæ—¶æ£€æŸ¥**
```go
if _, ok := i.(io.Writer); ok {
    fmt.Println("å®ç°äº† io.Writer")
}
```

**æ–¹æ³• 3ï¼šä½¿ç”¨åå°„**
```go
func implements(concrete interface{}, target interface{}) bool {
    concreteType := reflect.TypeOf(concrete)
    targetType := reflect.TypeOf(target).Elem()
    return concreteType.Implements(targetType)
}

// ä½¿ç”¨
var w io.Writer
implements((*MyWriter)(nil), &w)
```

### 5. ç©ºæ¥å£ interface{} å’Œ any æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

Go 1.18 å¼•å…¥äº† `any` ä½œä¸º `interface{}` çš„åˆ«åï¼š

```go
// Go 1.18+
type any = interface{}

// ä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰ä»·
func Print(v interface{}) {}
func Print(v any) {}
```

**åŒºåˆ«ï¼š**
- æœ¬è´¨ä¸Šå®Œå…¨ç›¸åŒï¼Œ`any` åªæ˜¯ `interface{}` çš„ç±»å‹åˆ«å
- `any` æ›´ç®€æ´ï¼Œæé«˜ä»£ç å¯è¯»æ€§
- æ¨èåœ¨ Go 1.18+ ä¸­ä½¿ç”¨ `any`

### 6. æ¥å£çš„åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆï¼š**

```go
var w io.Writer

// æ­¤æ—¶ï¼šåŠ¨æ€ç±»å‹ = nilï¼ŒåŠ¨æ€å€¼ = nil
fmt.Println(w == nil)  // true

w = os.Stdout
// æ­¤æ—¶ï¼šåŠ¨æ€ç±»å‹ = *os.Fileï¼ŒåŠ¨æ€å€¼ = os.Stdout

w = new(bytes.Buffer)
// æ­¤æ—¶ï¼šåŠ¨æ€ç±»å‹ = *bytes.Bufferï¼ŒåŠ¨æ€å€¼ = new(bytes.Buffer)
```

**æ¦‚å¿µï¼š**
- **åŠ¨æ€ç±»å‹**ï¼šæ¥å£å˜é‡å®é™…å­˜å‚¨çš„ç±»å‹
- **åŠ¨æ€å€¼**ï¼šæ¥å£å˜é‡å®é™…å­˜å‚¨çš„å€¼
- åªæœ‰åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€å€¼éƒ½ä¸º nil æ—¶ï¼Œæ¥å£æ‰ç­‰äº nil

### 7. ä¸ºä»€ä¹ˆ Go çš„æ¥å£è®¾è®¡æ˜¯éšå¼å®ç°ï¼Ÿ

**ç­”æ¡ˆï¼š**

**ä¼˜åŠ¿ï¼š**
1. **è§£è€¦**ï¼šå®ç°å’Œæ¥å£å®šä¹‰åˆ†ç¦»ï¼Œæ— éœ€æ˜¾å¼å£°æ˜
2. **çµæ´»**ï¼šå¯ä»¥ä¸ºç¬¬ä¸‰æ–¹ç±»å‹å®ç°æ¥å£
3. **æ¸è¿›å¼**ï¼šå¯ä»¥å…ˆå®šä¹‰ç±»å‹ï¼Œåå®šä¹‰æ¥å£
4. **æµ‹è¯•å‹å¥½**ï¼šå®¹æ˜“åˆ›å»º Mock å¯¹è±¡

**ç¤ºä¾‹ï¼š**
```go
// å¯ä»¥ä¸ºæ ‡å‡†åº“ç±»å‹å®ç°è‡ªå®šä¹‰æ¥å£
type Stringer interface {
    String() string
}

// int ç±»å‹æ²¡æœ‰å®ç° Stringerï¼Œä½†å¯ä»¥é€šè¿‡ç±»å‹å®šä¹‰å®ç°
type MyInt int

func (m MyInt) String() string {
    return fmt.Sprintf("MyInt: %d", m)
}
```

### 8. æ¥å£çš„ç±»å‹æ–­è¨€å’Œç±»å‹é€‰æ‹©æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

**ç±»å‹æ–­è¨€ï¼ˆType Assertionï¼‰**
```go
// å•ä¸€ç±»å‹æ£€æŸ¥
s := i.(string)           // ä¸å®‰å…¨ï¼Œå¤±è´¥ä¼š panic
s, ok := i.(string)       // å®‰å…¨ï¼Œå¤±è´¥è¿”å› false
```

**ç±»å‹é€‰æ‹©ï¼ˆType Switchï¼‰**
```go
// å¤šç±»å‹æ£€æŸ¥
switch v := i.(type) {
case string:
    fmt.Println("å­—ç¬¦ä¸²:", v)
case int:
    fmt.Println("æ•´æ•°:", v)
default:
    fmt.Println("å…¶ä»–ç±»å‹")
}
```

**åŒºåˆ«ï¼š**
- ç±»å‹æ–­è¨€ç”¨äºæ£€æŸ¥å•ä¸€ç±»å‹
- ç±»å‹é€‰æ‹©ç”¨äºæ£€æŸ¥å¤šä¸ªç±»å‹
- ç±»å‹é€‰æ‹©æ›´é€‚åˆå¤„ç†å¤šç§å¯èƒ½çš„ç±»å‹

### 9. æ¥å£ç»„åˆå’Œç»“æ„ä½“ç»„åˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ¥å£ç»„åˆ**
```go
type Reader interface {
    Read(p []byte) (n int, err error)
}

type Writer interface {
    Write(p []byte) (n int, err error)
}

// æ¥å£ç»„åˆï¼šç»§æ‰¿æ‰€æœ‰æ–¹æ³•
type ReadWriter interface {
    Reader
    Writer
}
```

**ç»“æ„ä½“ç»„åˆ**
```go
type Reader struct{}
func (r Reader) Read(p []byte) (n int, err error) { return }

type Writer struct{}
func (w Writer) Write(p []byte) (n int, err error) { return }

// ç»“æ„ä½“ç»„åˆï¼šåµŒå…¥å­—æ®µ
type ReadWriter struct {
    Reader
    Writer
}
```

**åŒºåˆ«ï¼š**
- æ¥å£ç»„åˆæ˜¯æ–¹æ³•é›†çš„å¹¶é›†
- ç»“æ„ä½“ç»„åˆæ˜¯å­—æ®µå’Œæ–¹æ³•çš„åµŒå…¥
- æ¥å£ç»„åˆæ›´è½»é‡ï¼Œåªå®šä¹‰è¡Œä¸º

### 10. å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„æ¥å£ï¼Ÿ

**ç­”æ¡ˆï¼š**

**è®¾è®¡åŸåˆ™ï¼š**

1. **æ¥å£åº”è¯¥å°è€Œç²¾**
```go
// âœ… æ¨è
type Reader interface {
    Read(p []byte) (n int, err error)
}

// âŒ ä¸æ¨è
type FileOperations interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
    Close() error
    Seek(offset int64, whence int) (int64, error)
}
```

2. **æ¥å—æ¥å£ï¼Œè¿”å›å…·ä½“ç±»å‹**
```go
// âœ… æ¨è
func NewReader(r io.Reader) *BufferedReader

// âŒ ä¸æ¨è
func NewReader(r io.Reader) io.Reader
```

3. **åœ¨ä½¿ç”¨æ–¹å®šä¹‰æ¥å£**
```go
// âœ… æ¨èï¼šåœ¨ client åŒ…ä¸­å®šä¹‰
package client

type DataStore interface {
    Get(key string) (string, error)
}

// âŒ ä¸æ¨èï¼šåœ¨ provider åŒ…ä¸­å®šä¹‰
package provider

type DataStore interface {
    Get(key string) (string, error)
    Set(key, value string) error
    Delete(key string) error
}
```

4. **é¿å…æ¥å£æ±¡æŸ“**
```go
// âŒ ä¸æ¨èï¼šä¸å¿…è¦çš„æ¥å£
type UserGetter interface {
    GetUser() User
}

// âœ… æ¨èï¼šç›´æ¥ä½¿ç”¨å…·ä½“ç±»å‹
func GetUser() User
```

---

## æœ€ä½³å®è·µ

### 1. æ¥å£åº”è¯¥å°è€Œç²¾

```go
// âœ… æ¨è
type Reader interface {
    Read(p []byte) (n int, err error)
}

// âŒ ä¸æ¨è
type FileOperations interface {
    Read(p []byte) (n int, err error)
    Write(p []byte) (n int, err error)
    Close() error
    Seek(offset int64, whence int) (int64, error)
}
```

### 2. æ¥å—æ¥å£ï¼Œè¿”å›å…·ä½“ç±»å‹

```go
// âœ… æ¨è
func Process(r io.Reader) *Result

// âŒ ä¸æ¨è
func Process(r io.Reader) io.Reader
```

### 3. åœ¨ä½¿ç”¨æ–¹å®šä¹‰æ¥å£

```go
// âœ… æ¨èï¼ˆåœ¨ä½¿ç”¨æ–¹å®šä¹‰ï¼‰
package client

type DataStore interface {
    Get(key string) (string, error)
}

func Process(store DataStore) {
    // ...
}
```

---

## å‚è€ƒèµ„æ–™

- [x] [Go å®˜æ–¹æ–‡æ¡£ - Interfaces](https://go.dev/ref/spec#Interface_types)
- [x] [Effective Go - Interfaces](https://go.dev/doc/effective_go#interfaces)
- [x] [Go by Example - Interfaces](https://gobyexample.com/interfaces)

---

**ä¸‹ä¸€èŠ‚ï¼š** [10-é”™è¯¯å¤„ç†](./10-é”™è¯¯å¤„ç†.md)
